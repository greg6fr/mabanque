pipeline {
    // Spécifier que le pipeline peut s'exécuter sur n'importe quel agent
    agent any

    // Déclarer les variables d'environnement utilisées dans le pipeline
    environment {
        GIT_REPO = "https://github.com/greg6fr/mabanque.git"
        NODE_VERSION = "20"
    }

    stages {
        // 1. Cloner le dépôt
        stage('Cloner le dépôt') {
            steps {
                echo "Clonage du dépôt Github"
                git branch: 'main', url: "${GIT_REPO}"
            }
        }



        // 2. Installer les dépendances Angular
        stage('Installer les dépendances Angular') {
            steps {
                echo 'Installation des dépendances Angular'
                sh 'npm install'
            }
        }

        // 3. Construire l'application
        stage('Construire l\'application') {
            steps {
                echo 'Construction de l\'application Angular en mode production'
                sh 'npm run build'
            }
        }

        // 4. Afficher les fichiers générés
        stage('Afficher les fichiers générés') {
            steps {
                echo 'Liste des fichiers générés dans le dossier dist/mabanque'
                sh 'ls -al dist/mabanque'
            }
        }
    }

    // Étapes post-pipeline
    post {
        always {
            echo 'Pipeline terminé.'
        }
    }
}
